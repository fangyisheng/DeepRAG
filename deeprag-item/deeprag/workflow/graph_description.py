import asyncio

#今天3月7日要改完这个bug
async def describe_graph(graph):
    graph_description_list = []
    for relation in graph["relations"]:
        relation_head_text = next((entity["text"] for entity in graph["entities"] if entity["id"] == relation["head"]),None)
        relation_tail_text = next((entity["text"] for entity in graph["entities"] if entity["id"] == relation["tail"]),None)

        if isinstance(relation["type"],str):
            graph_description = f"{relation_head_text}和{relation_tail_text}的关系是{relation_head_text}{relation["type"]}{relation_tail_text}"
            graph_description_list.append(graph_description)
        else:
            for type in relation["type"]:
                graph_description = f"{relation_head_text}和{relation_tail_text}的关系是{relation_head_text}{type}{relation_tail_text}"
                graph_description_list.append(graph_description)
    return graph_description_list

# test_data = {'entities': [{'id': 'fd24920c-b025-474f-b2db-c962a9cffe33', 'text': 'Microsoft', 'type': 'company'}, {'id': 'd0cf5587-b703-48b7-a75b-3729c93c6f61', 'text': 'Satya Nadella', 'type': ['person', 'manager']}, {'id': '6adef422-5f7f-43f5-8770-e4bf930073b6', 'text': 'Azure AI', 'type': 'product'}], 'relations': [{'head': 'Satya Nadella', 'tail': 'Microsoft', 'type': 'CEO of', 'id': 'b6cb2adf-540d-448a-b198-8e841ba92c96'}, {'head': 'Microsoft', 'tail': 'Azure AI', 'type': ['developed', 'product'], 'id': 'b28a1ddc-4d69-4948-9f7f-e8eb5863c4ff'}]}
test_data_2 =  {'entities': [{'id': 'b05cf224-750e-4516-ac95-1db189db02c5', 'text': '深度求索', 'type': '公司'}, {'id': 'de3e0ff4-d603-4518-8e1a-8d2a675c314c', 'text': 'DeepSeek', 'type': '公司'}, {'id': '36ec94c4-dd9b-4c62-9751-37eb0a6c6041', 'text': 'AI领域', 'type': '领域'}, {'id': 'd98b79b3-8f26-425a-9176-ba8056762caa', 'text': '美股市场', 'type': '市场'}, {'id': 'df3bb4db-c2e5-4fed-b62d-07a8068f8699', 'text': '英伟达', 'type': '公司'}, {'id': 'bd39d3e5-d74c-4922-b258-f45fff6e6278', 'text': 'OpenAI', 'type': '公司'}, {'id': 'd2ca884e-5192-47e2-b55e-e5d294d216dc', 'text': 'GPT-4o', 'type': '产品'}, {'id': '628838e1-6b6c-49ad-b740-376dd579882a', 'text': '幻方量化', 'type': '公司'}, {'id': '8c1a1d67-076a-40c6-a0de-e64a0658bbd3', 'text': '萤火二号', 'type': '产品'}, {'id': 'd6f1c85a-4a53-4193-8150-1ac447760450', 'text': '华为云', 'type': '产品'}, {'id': '04fa64ab-6eaa-46fb-a732-d2a7fcef184a', 'text': '腾讯云', 'type': '产品'}, {'id': 'fb52aebf-46c5-4fbd-8978-c18bd04f4e46', 'text': '百度云', 'type': '产品'}, {'id': '7d656b8e-a377-4083-b626-0ed350421807', 'text': 'MLA架构', 'type': '技术'}, {'id': '430f0d72-1ee3-4bd3-b431-a4f3a9424185', 'text': 'MHA架构', 'type': '技术'}, {'id': 'a654a225-2276-4a97-8114-40b625be66db', 'text': 'DeepSeek MoEs Parse结构', 'type': '技术'}, {'id': '6c6692d7-32f0-4b3b-ab64-93d32cfc5df9', 'text': '硅谷', 'type': '地点'}, {'id': '4f4c9d84-ee72-4d8a-a716-3ca29aca074a', 'text': 'DeepSeek-R1模型', 'type': '产品'}, {'id': 'f3ebe6d0-5f6a-4e53-a20f-5888b0c06ff2', 'text': 'OpenAI o1模型', 'type': '产品'}, {'id': '08d88a4e-728b-4a59-91dd-154b36f0b5cd', 'text': '纳米AI搜索', 'type': '产品'}, {'id': '7d57c5e4-20af-4e0c-a8b5-28b1e64c9e7b', 'text': '周鸿祎', 'type': '人物'}, {'id': '3cd902ed-7363-47e2-8328-7c04d3afc5e4', 'text': '小鹏汽车', 'type': '公司'}, {'id': '3cae73bf-baee-46c2-8560-08985b47c23a', 'text': '何小鹏', 'type': '人物'}, {'id': 'e09d2158-753c-4710-aa1d-6b8b0c3db75d', 'text': '阿里巴巴', 'type': '公司'}, {'id': '9d1be6a8-034d-46af-aa6f-5c0693e734c3', 'text': '京东', 'type': '公司'}, {'id': '23ef3a20-97d0-44de-9ef0-cb32164e259d', 'text': '清华大学', 'type': '机构'}, {'id': '30b2ce9b-e334-4ce3-b8e7-cba5c34e690b', 'text': 'A大学', 'type': '机构'}, {'id': '25229687-74d5-4d95-bae8-299c406562d9', 'text': '微软', 'type': '公司'}, {'id': '65a6d525-6d16-4401-8b1a-f9a77a5d820e', 'text': '亚马逊', 'type': '公司'}], 'relations': [{'head': 'b05cf224-750e-4516-ac95-1db189db02c5', 'tail': 'de3e0ff4-d603-4518-8e1a-8d2a675c314c', 'type': '别名', 'id': '85d10a06-c7e6-4a83-95fb-648eb24f8624'}, {'head': 'b05cf224-750e-4516-ac95-1db189db02c5', 'tail': '36ec94c4-dd9b-4c62-9751-37eb0a6c6041', 'type': '属于', 'id': 'e9edf041-702c-4b4b-b7c4-757737722b64'}, {'head': 'd98b79b3-8f26-425a-9176-ba8056762caa', 'tail': 'b05cf224-750e-4516-ac95-1db189db02c5', 'type': '受影响', 'id': 'd791cff4-dc77-4b9c-8a6b-267631f20731'}, {'head': 'df3bb4db-c2e5-4fed-b62d-07a8068f8699', 'tail': 'd98b79b3-8f26-425a-9176-ba8056762caa', 'type': '影响', 'id': '55abdaf4-5658-4dfa-a6f3-e4f581841eac'}, {'head': 'bd39d3e5-d74c-4922-b258-f45fff6e6278', 'tail': 'd2ca884e-5192-47e2-b55e-e5d294d216dc', 'type': '开发', 'id': '2aae12c3-85f7-41d3-9d8f-3f32c7fb6955'}, {'head': '628838e1-6b6c-49ad-b740-376dd579882a', 'tail': 'b05cf224-750e-4516-ac95-1db189db02c5', 'type': '投资', 'id': '34c82cfe-2355-4d56-a824-90d01268d5ff'}, {'head': '8c1a1d67-076a-40c6-a0de-e64a0658bbd3', 'tail': '628838e1-6b6c-49ad-b740-376dd579882a', 'type': '属于', 'id': 'd5e12dcd-840b-41fa-9d63-1a6b1a0461b1'}, {'head': 'd6f1c85a-4a53-4193-8150-1ac447760450', 'tail': 'b05cf224-750e-4516-ac95-1db189db02c5', 'type': '合作', 'id': '484e83aa-a823-48fb-a639-bd5df676ffc2'}, {'head': '04fa64ab-6eaa-46fb-a732-d2a7fcef184a', 'tail': 'b05cf224-750e-4516-ac95-1db189db02c5', 'type': '合作', 'id': '54f68693-a102-416b-baa6-ecd90b3a84fe'}, {'head': 'fb52aebf-46c5-4fbd-8978-c18bd04f4e46', 'tail': 'b05cf224-750e-4516-ac95-1db189db02c5', 'type': '合作', 'id': '3abfe935-609b-4273-99cb-708ba081eeb0'}, {'head': '7d656b8e-a377-4083-b626-0ed350421807', 'tail': 'b05cf224-750e-4516-ac95-1db189db02c5', 'type': '使用', 'id': 'b55d0c1b-acec-42e9-beb9-d66bfd578f42'}, {'head': '430f0d72-1ee3-4bd3-b431-a4f3a9424185', 'tail': '7d656b8e-a377-4083-b626-0ed350421807', 'type': '对比', 'id': 'd8f1f9c1-fb00-4d99-9cfd-12c25886ba4a'}, {'head': 'a654a225-2276-4a97-8114-40b625be66db', 'tail': 'b05cf224-750e-4516-ac95-1db189db02c5', 'type': '开发', 'id': '644e90b1-d32f-4f96-ab68-9cc44f8838f2'}, {'head': '6c6692d7-32f0-4b3b-ab64-93d32cfc5df9', 'tail': 'b05cf224-750e-4516-ac95-1db189db02c5', 'type': '评价', 'id': '14fbd49c-7a70-4885-b4d7-82bebfa4b0d8'}, {'head': '4f4c9d84-ee72-4d8a-a716-3ca29aca074a', 'tail': 'b05cf224-750e-4516-ac95-1db189db02c5', 'type': '开发', 'id': 'd78382c5-8b1e-45a1-a9fc-340f8f5ec81f'}, {'head': 'f3ebe6d0-5f6a-4e53-a20f-5888b0c06ff2', 'tail': '4f4c9d84-ee72-4d8a-a716-3ca29aca074a', 'type': '对比', 'id': 'e6ec7a38-4822-42a5-9089-51ad8127236b'}, {'head': '08d88a4e-728b-4a59-91dd-154b36f0b5cd', 'tail': 'b05cf224-750e-4516-ac95-1db189db02c5', 'type': '合作', 'id': 'd19a4435-0803-4e60-a311-e2b1ff494028'}, {'head': '7d57c5e4-20af-4e0c-a8b5-28b1e64c9e7b', 'tail': '08d88a4e-728b-4a59-91dd-154b36f0b5cd', 'type': '提及', 'id': 'd0cbc947-6feb-4f2e-ade1-576bc690da3b'}, {'head': '3cd902ed-7363-47e2-8328-7c04d3afc5e4', 'tail': 'b05cf224-750e-4516-ac95-1db189db02c5', 'type': '计划合作', 'id': '034cb079-ba9a-4ad7-8c73-f3eebfdf4ab5'}, {'head': '3cae73bf-baee-46c2-8560-08985b47c23a', 'tail': '3cd902ed-7363-47e2-8328-7c04d3afc5e4', 'type': '担任', 'id': 'ab94e9c0-a827-4b2f-b280-82bd2f70ccf8'}, {'head': 'e09d2158-753c-4710-aa1d-6b8b0c3db75d', 'tail': 'b05cf224-750e-4516-ac95-1db189db02c5', 'type': '合作', 'id': '04e8a598-b4f9-4eb7-9b03-43894d5918b4'}, {'head': '9d1be6a8-034d-46af-aa6f-5c0693e734c3', 'tail': 'b05cf224-750e-4516-ac95-1db189db02c5', 'type': '合作', 'id': 'c13c39b0-18a0-4763-9e03-9f116f146188'}, {'head': '4f4c9d84-ee72-4d8a-a716-3ca29aca074a', 'tail': '23ef3a20-97d0-44de-9ef0-cb32164e259d', 'type': '互动', 'id': 'e81714d5-15bf-4e1a-b56a-81ab41409fe9'}, {'head': '4f4c9d84-ee72-4d8a-a716-3ca29aca074a', 'tail': '30b2ce9b-e334-4ce3-b8e7-cba5c34e690b', 'type': '互动', 'id': 'ffd4b1e5-0769-4532-88e0-374401298a49'}, {'head': '25229687-74d5-4d95-bae8-299c406562d9', 'tail': '65a6d525-6d16-4401-8b1a-f9a77a5d820e', 'type': '合作', 'id': 'ca76edbf-899f-4af9-8ad1-0999dcdc05f5'}]}


print(asyncio.run(describe_graph(test_data_2)))

